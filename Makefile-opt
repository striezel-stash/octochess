CXXFLAGS = -O3 -g -pipe -march=corei7 -std=gnu++0x -Wall -flto -fwhole-program -pthread -ldl
#CXXFLAGS = -O0 -g -pipe -std=gnu++0x

all: chess-use bookgen-use

GENERIC_SOURCE_FILES = \
	book.cpp \
	calc.cpp \
	config.cpp \
	detect_check.cpp \
	eval.cpp \
	fen.cpp \
	hash.cpp \
	logger.cpp \
	magic.cpp \
	mobility.cpp \
	moves.cpp \
	moves_captures.cpp \
	moves_noncaptures.cpp \
	pawn_structure_hash_table.cpp \
	phased_move_generator.cpp \
	pvlist.cpp \
	random.cpp \
	util.cpp \
	see.cpp \
	seen_positions.cpp \
	selftest.cpp \
	statistics.cpp \
	string.cpp \
	tables.cpp \
	unix.cpp \
	zobrist.cpp \
	sqlite/sqlite3.o

CHESS_SOURCE_FILES = $(GENERIC_SOURCE_FILES) \
	chess.cpp \
	tweak.cpp \
	xboard.cpp \
	uci/info.cpp \
	uci/minimalistic_uci_protocol.cpp \
	uci/octochess_impl.cpp \
	uci/runner.cpp \
	uci/time.cpp

BOOKGEN_SOURCE_FILES = $(GENERIC_SOURCE_FILES) \
	bookgen.cpp

chess-gen: *.cpp *.hpp
	g++ $(CXXFLAGS) -fprofile-generate -o $@ $(CHESS_SOURCE_FILES)
	./chess-gen --moves 1 --depth 11 --threads 1 auto
	rm -f *.o uci/*.o

chess-use: chess-gen
	g++ $(CXXFLAGS) -fprofile-use -fprofile-correction -o $@ $(CHESS_SOURCE_FILES)

bookgen-use: chess-gen
	g++ $(CXXFLAGS) -fprofile-use -fprofile-correction -o $@ $(BOOKGEN_SOURCE_FILES)

clean:
	rm -f chess-gen
	rm -f *.o uci/*.o
